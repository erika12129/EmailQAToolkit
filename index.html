<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email QA Automation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2563eb;
            text-align: center;
        }
        .container {
            background-color: #f9fafb;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="file"] {
            border: 1px solid #ddd;
            padding: 8px;
            width: 100%;
            border-radius: 4px;
        }
        button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1d4ed8;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }
        .tab-button.active {
            border-bottom: 2px solid #2563eb;
            color: #2563eb;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .results {
            margin-top: 20px;
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .pass {
            color: green;
        }
        .fail {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Email QA Automation Tool</h1>
    <p style="text-align: center;">Validate HTML emails against campaign requirements</p>

    <div class="tab-buttons">
        <button class="tab-button active" data-tab="single">Single Email QA</button>
        <button class="tab-button" data-tab="batch">Batch Processing</button>
        <button class="tab-button" data-tab="localized">Localization QA</button>
    </div>

    <!-- Single Email QA -->
    <div id="single-tab" class="tab-content active">
        <div class="container">
            <h2>Validate a Single Email</h2>
            <p>Upload an email HTML file and its requirements to validate.</p>
            
            <form id="single-form">
                <div class="form-group">
                    <label for="email">Email HTML File</label>
                    <input type="file" id="email" name="email" accept=".html">
                </div>
                
                <div class="form-group">
                    <label for="requirements">Requirements JSON File</label>
                    <input type="file" id="requirements" name="requirements" accept=".json">
                </div>
                
                <button type="submit">Validate Email</button>
                <button type="button" id="load-sample">Load Sample</button>
            </form>
            
            <div id="single-results" class="results">
                <h3>Validation Results</h3>
                
                <h4>Metadata Validation</h4>
                <table id="metadata-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Expected</th>
                            <th>Actual</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <h4>Link Validation</h4>
                <table id="links-table">
                    <thead>
                        <tr>
                            <th>Link Text</th>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Issues</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Batch Processing -->
    <div id="batch-tab" class="tab-content">
        <div class="container">
            <h2>Batch Process Multiple Emails</h2>
            <p>Upload multiple email HTML files with a single requirements file.</p>
            
            <form id="batch-form">
                <div class="form-group">
                    <label for="batch-emails">Email HTML Files (multiple)</label>
                    <input type="file" id="batch-emails" name="emails" accept=".html" multiple>
                </div>
                
                <div class="form-group">
                    <label for="batch-requirements">Requirements JSON File</label>
                    <input type="file" id="batch-requirements" name="requirements" accept=".json">
                </div>
                
                <button type="submit">Run Batch Validation</button>
            </form>
            
            <div id="batch-results" class="results">
                <h3>Batch Validation Results</h3>
                <div id="batch-results-container"></div>
            </div>
        </div>
    </div>

    <!-- Localization QA -->
    <div id="localized-tab" class="tab-content">
        <div class="container">
            <h2>Localization QA</h2>
            <p>Compare a localized email with its parent version.</p>
            
            <form id="localized-form">
                <div class="form-group">
                    <label for="localized-email">Localized Email HTML File</label>
                    <input type="file" id="localized-email" name="localized_email" accept=".html">
                </div>
                
                <div class="form-group">
                    <label for="localized-requirements">Localized Requirements JSON File</label>
                    <input type="file" id="localized-requirements" name="localized_requirements" accept=".json">
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="compare-parent" name="compare_to_parent" checked>
                    <label for="compare-parent" style="display: inline;">Compare with parent (en_US) email</label>
                </div>
                
                <div id="parent-fields">
                    <div class="form-group">
                        <label for="parent-email">Parent Email HTML File (en_US)</label>
                        <input type="file" id="parent-email" name="parent_email" accept=".html">
                    </div>
                    
                    <div class="form-group">
                        <label for="parent-requirements">Parent Requirements JSON File</label>
                        <input type="file" id="parent-requirements" name="parent_requirements" accept=".json">
                    </div>
                </div>
                
                <button type="submit">Run Localization Check</button>
                <button type="button" id="load-localized-sample">Load Sample</button>
            </form>
            
            <div id="localized-results" class="results">
                <h3>Localization Validation Results</h3>
                
                <h4>Metadata Validation</h4>
                <table id="localized-metadata-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Expected</th>
                            <th>Actual</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <h4>Link Validation</h4>
                <table id="localized-links-table">
                    <thead>
                        <tr>
                            <th>Link Text</th>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Issues</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <div id="locale-comparison-section">
                    <h4>Localization Pattern Comparison</h4>
                    <table id="locale-comparison-table">
                        <thead>
                            <tr>
                                <th>Link Text</th>
                                <th>Localized URL</th>
                                <th>Matches Parent</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active tab content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(tab + '-tab').classList.add('active');
                });
            });
            
            // Single Email Form
            const singleForm = document.getElementById('single-form');
            singleForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                fetch('/run-qa', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    displaySingleResults(data);
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
            });
            
            // Batch Processing Form
            const batchForm = document.getElementById('batch-form');
            batchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                fetch('/run-batch-qa', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    displayBatchResults(data);
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
            });
            
            // Localization QA Form
            const localizedForm = document.getElementById('localized-form');
            localizedForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                fetch('/run-localized-qa', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    displayLocalizedResults(data);
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
            });
            
            // Load Sample Button
            document.getElementById('load-sample').addEventListener('click', function() {
                // This functionality would require additional JavaScript to handle
                // Typically we'd use the fetch API to load sample data and create File objects
                alert('Loading sample data is not implemented in this simplified version');
            });
            
            // Load Localized Sample Button
            document.getElementById('load-localized-sample').addEventListener('click', function() {
                // This functionality would require additional JavaScript to handle
                alert('Loading sample data is not implemented in this simplified version');
            });
            
            // Toggle Parent Fields
            document.getElementById('compare-parent').addEventListener('change', function() {
                document.getElementById('parent-fields').style.display = this.checked ? 'block' : 'none';
            });
            
            // Function to display single email results
            function displaySingleResults(data) {
                // Metadata results
                const metadataTable = document.querySelector('#metadata-table tbody');
                metadataTable.innerHTML = '';
                
                data.metadata.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.field}</td>
                        <td>${item.expected}</td>
                        <td>${item.actual}</td>
                        <td class="${item.status === 'PASS' ? 'pass' : 'fail'}">${item.status}</td>
                    `;
                    metadataTable.appendChild(row);
                });
                
                // Links results
                const linksTable = document.querySelector('#links-table tbody');
                linksTable.innerHTML = '';
                
                data.links.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.link_text}</td>
                        <td>${item.url}</td>
                        <td class="${item.status === 'PASS' ? 'pass' : 'fail'}">${item.status}</td>
                        <td>${item.utm_issues ? item.utm_issues.join('<br>') : 'None'}</td>
                    `;
                    linksTable.appendChild(row);
                });
                
                // Show results
                document.getElementById('single-results').style.display = 'block';
            }
            
            // Function to display batch results
            function displayBatchResults(data) {
                const batchResultsContainer = document.getElementById('batch-results-container');
                batchResultsContainer.innerHTML = '';
                
                for (const [filename, results] of Object.entries(data)) {
                    const emailResult = document.createElement('div');
                    emailResult.className = 'email-result';
                    emailResult.innerHTML = `
                        <h4>${filename}</h4>
                        <p>Metadata: ${results.metadata.filter(m => m.status === 'PASS').length}/${results.metadata.length} passed</p>
                        <p>Links: ${results.links.filter(l => l.status === 'PASS').length}/${results.links.length} passed</p>
                    `;
                    batchResultsContainer.appendChild(emailResult);
                }
                
                // Show results
                document.getElementById('batch-results').style.display = 'block';
            }
            
            // Function to display localized results
            function displayLocalizedResults(data) {
                // Metadata results
                const metadataTable = document.querySelector('#localized-metadata-table tbody');
                metadataTable.innerHTML = '';
                
                data.metadata.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.field}</td>
                        <td>${item.expected}</td>
                        <td>${item.actual}</td>
                        <td class="${item.status === 'PASS' ? 'pass' : 'fail'}">${item.status}</td>
                    `;
                    metadataTable.appendChild(row);
                });
                
                // Links results
                const linksTable = document.querySelector('#localized-links-table tbody');
                linksTable.innerHTML = '';
                
                data.links.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.link_text}</td>
                        <td>${item.url}</td>
                        <td class="${item.status === 'PASS' ? 'pass' : 'fail'}">${item.status}</td>
                        <td>${item.utm_issues ? item.utm_issues.join('<br>') : 'None'}</td>
                    `;
                    linksTable.appendChild(row);
                });
                
                // Locale comparison results
                const comparisonSection = document.getElementById('locale-comparison-section');
                
                if (data.locale_comparison && data.locale_comparison.length > 0) {
                    const comparisonTable = document.querySelector('#locale-comparison-table tbody');
                    comparisonTable.innerHTML = '';
                    
                    data.locale_comparison.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.link_text}</td>
                            <td>${item.localized_url}</td>
                            <td>${item.matches_parent_structure ? 'Yes' : 'No'}</td>
                            <td class="${item.status === 'PASS' ? 'pass' : 'fail'}">${item.status}</td>
                        `;
                        comparisonTable.appendChild(row);
                    });
                    
                    comparisonSection.style.display = 'block';
                } else {
                    comparisonSection.style.display = 'none';
                }
                
                // Show results
                document.getElementById('localized-results').style.display = 'block';
            }
        });
    </script>
</body>
</html>